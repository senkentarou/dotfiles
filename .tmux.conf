#
# Tmux Window settings
#

# Fundamentals
set -g default-shell "${SHELL}"
set -g default-command "${SHELL}"
set -g default-terminal 'screen-256color'
set -g terminal-overrides 'xterm:colors=256'

set -gq status-utf8 "on"
set -g history-limit 10000

# Indexing
setw -g mouse on
setw -g automatic-rename off
setw -g pane-base-index 1
set -g base-index 1
set -g renumber-windows on
set -g focus-events on
set -g set-titles off

# Timing
set -g escape-time 1
set -g repeat-time 500

# Colors
set -g status-style bg=colour241,fg=colour255
setw -g window-status-format " @#I "
setw -g window-status-style bg=default,fg=colour245
setw -g window-status-current-format " @#I "
setw -g window-status-current-style bg=colour196,fg=colour255
set -g pane-border-style bg=default,fg=colour255
set -g pane-active-border-style bg=default,fg=green
set -g pane-border-status bottom
set -g pane-border-format "#{?pane_active,#[fg=green] ● #(printf '%%')#{pane_index} #[default],#[fg=grey] ○ #(printf '%%')#{pane_index} #[default]}"
set -g message-style bg=colour196,fg=colour255
set -g mode-style bg=cyan,fg=black

# Status Bar Style
set -g status-position top
set -g status-justify left
set -g status-interval 5
set -g status-left-length 100
set -g status-right-length 100
set -g status-right "#[fg=colour255,bg=colour241] #(~/.config/tmux/claude_code_status.sh) #[default]"

#
# KeyBindings
#

# to set my prefix
unbind C-b
set -g prefix C-s
bind C-s send-prefix

# to reload tmux settings
bind C-r source-file ~/.tmux.conf \; display "Reloaded!"

# to operate window / pane
unbind n # disable next-window
unbind p # disable previous-window
unbind s # disable choose-tree
unbind x # disable kill-pane
unbind z # disable resize-pane -Z (focus pane)
unbind d # disable detach session
unbind space # disable re-arrange pane

bind - split-window -v -c "#{pane_current_path}"
bind \\ split-window -h -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"

# jump to claude code (cc) session
bind = if-shell 'tmux has-session -t "CC" 2>/dev/null' \
  'switch-client -t "CC"' \
  'run-shell "tmux new-session -s CC -d && tmux send-keys -t CC claude C-m && tmux switch-client -t CC"'

bind -n M-h switch-client -p
bind -n M-j switch-client -n
bind -n M-k switch-client -p
bind -n M-l switch-client -n

bind -r C-h previous-window
bind -r C-j select-pane -t :.+
bind -r C-k select-pane -t :.-
bind -r C-l next-window

bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R
bind ';' choose-tree -s

bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# prefix + / to search in copy mode
bind / copy-mode \; send-keys ?

# to scroll terminal logs
setw -g mode-keys vi
bind m copy-mode
bind -Tcopy-mode-vi v send -X begin-selection
bind -Tcopy-mode-vi V send -X select-line
bind -Tcopy-mode-vi C-v send -X rectangle-toggle
bind -Tcopy-mode-vi y send -X copy-selection
bind -Tcopy-mode-vi Y send -X copy-line
# avoid auto-exit copy mode when mouse drag is end. use y key to copy or CR key to mode off with copy
unbind -Tcopy-mode-vi MouseDragEnd1Pane
